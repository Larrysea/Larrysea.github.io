---
layout:     post
title:      WebView 加速方案总结
subtitle:   WebView 性能优化总结
date:       2018-07-27
author:     larrysea
header-img: img/post-bg-android.jpg
catalog: true
tags:
    - Android
    - 性能优化
    - 网络
---

### 1 项目现有优化方案介绍:

1  缓存WebView 池

2  代理webview 图片网络请求

3  推荐栏目数据预加载，且是wifi情况，现在enable preload 是关闭状态，这样最终通过id的去请求返回文章数据本地缓存起来，在使用的时候直接使用缓存数据。一个存放在内存中一个存放在数据库中

4  JS html模板更新，让大的js提前更新到本地



>  缓存文章数据.主要流程:WebDetailActivity 同理



![WebDetailFragment和WebDetailActivity 加载流程图](http://oz4olx68e.bkt.clouddn.com/image/%E7%BD%91%E7%BB%9C%E9%A2%84%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg)

### 2   现有优化方案局限性：

1 现有只是将文章类进行了加速优化，其他类型没有进行优化，其他类型只针对了Js 资源进行了下载优化。

2 这个优化也只是缓存优化，有花的是二次打开时间，如果是第一次打开文章还是会造成需要请求，需要等待时间。

3 优化方案只在Android 4.4 以上进行了优化。

4 预加载没有开起来，并且预加载的文章方位只限于推荐类型的文章。



### 3  加载h5 页主要耗时的几个大方面：

数据来源于有赞，wifi情况测试

Webview 初始化  耗时100ms-200ms 首次加载webview 耗时

dns解析+tcp 链接：20ms ~ 1.5ms  波动较大，最差的情况到1.5s

html下载：约200ms - 600ms  

html解析：100ms- 150ms

静态资源下载：50 - 200ms 同步资源消耗，异步资源未统计。 



### 4  其他厂家方案介绍

#### 1  有赞平台加速方案总结：

- 应用启动维护一个全局webview
- dns解析优化，预拉取
- 对于css/js 做缓存，效果有限，对于白屏时间优化有限
-  html预取以及缓

#### 2  美团加速方案总结:

- WebView初始化慢，可以在初始化同时先请求数据，让后端和网络不要闲着。

- 后端处理慢，可以让服务器分trunk输出，在后端计算的同时前端也加载网络静态资源。

- 脚本执行慢，就让脚本在最后运行，不阻塞页面解析。

- 同时，合理的预加载、预缓存可以让加载速度的瓶颈更小。

- WebView初始化慢，就随时初始化好一个WebView待用。

- DNS和链接慢，想办法复用客户端使用的域名和链接。

- 脚本执行慢，可以把框架代码拆分出来，在请求页面之前就执行好。

#### 3  网易加速方案总结：

- 将资源包打包到apk中减少请求资源带来的时间

- 代理图片等网络请求

#### 4  腾讯Vassonic 加速方案总结：

-  完整的接入需要server端，前端接入，但是也可以不接入使用local server模式但是会牺牲一部分性能  

-  支持html 数据增量更新，只更新data 部分，该框架将每个页面都分文data 和 template 两部分，减少网络请求量，前提页端需要接入

-  并行初始化webview 和数据加载部分逻辑

-  代理webview 网络请求，通过UrlConnection获取网页数据

  

#### 5 其他杂项方案：

- 刚进入页面组织客户端加载网页中图片等到避免网络拥塞，等到页面加载完毕以后再开始加载图片。

- 开启默认webview缓存，开始Dom 

- 将很少会更新的公共资源文件放过在本地例如js/cs 文件

- 离线包方案，将一下列文章作为一个包提前下载好，本地直接加载，而不是直接请求网络

- 设置webview.getSettings().setRenderPriority(RenderPriority.HIGH) 设置webview 渲染优先级为最高。

- 设置硬件加速，可能出现一些不可预知问题，例如在被其他view遮挡以后可能出现白屏问题

- 通过监控后台监控数据来预判哪些文章是可能读，提前通过推送方式告诉客户端进行预缓存，减少打开耗时

  

  
参考链接：  有赞webview 加速方案 https://tech.youzan.com/youzan-webview-goldwing-one/

  ​                    bang 神的总结：https://blog.cnbang.net/tech/3477/

​                      网页加载Js慢耗时解决方案：http://www.cnblogs.com/xinye/p/3144139.html

​                      美团性能优化总结：https://tech.meituan.com/WebViewPerf.html

​                      Goolge 网页性能测评工具（中国地区可以使用）：https://developers.google.cn/speed/pagespeed/insights/

​                      雅虎网页性能优化14 条：https://github.com/ellyliang/Note/blob/master/html%26css/%E9%9B%85%E8%99%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%8414%E6%9D%A1%E8%A7%84%E5%88%99.md

  

​    

  

  

  

  

 












​	







